# DEPARTMENTS TABLE  
CREATE TABLE "MOSZCZYNSKIL"."DEPARTMENTS" 
   (	"DEPARTMENT_ID" NUMBER(*,0) NOT NULL ENABLE, 
	"DEPARTMENT_NAME" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"MANAGER_ID" NUMBER(*,0), 
	"LOCATION_ID" NUMBER(*,0) NOT NULL ENABLE, 
	 CONSTRAINT "DEPARTMENTS_PK" PRIMARY KEY ("DEPARTMENT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE, 
	 CONSTRAINT "LOCATIONS_FK" FOREIGN KEY ("LOCATION_ID")
	  REFERENCES "MOSZCZYNSKIL"."LOCATIONS" ("LOCATION_ID") ENABLE, 
	 CONSTRAINT "DEPARTMENTS_MANAGER_FK" FOREIGN KEY ("MANAGER_ID")
	  REFERENCES "MOSZCZYNSKIL"."EMPLOYEES" ("EMPLOYEE_ID") ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;

# LOCATIONS TABLE
CREATE TABLE "MOSZCZYNSKIL"."LOCATIONS" 
   (	"LOCATION_ID" NUMBER(*,0) NOT NULL ENABLE, 
	"STREET_ADDRESS" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"POSTAL_CODE" VARCHAR2(6 BYTE) NOT NULL ENABLE, 
	"CITY" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"STATE_PROVINCE" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"COUNTRY_ID" NUMBER(*,0) NOT NULL ENABLE, 
	 CONSTRAINT "LOCATIONS_PK" PRIMARY KEY ("LOCATION_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;

# COUNTRIES TABLE
  CREATE TABLE "MOSZCZYNSKIL"."COUNTRIES" 
   (	"COUNTRY_ID" NUMBER(*,0) NOT NULL ENABLE, 
	"COUNTRY_NAME" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"REGION_ID" NUMBER(*,0) NOT NULL ENABLE, 
	 CONSTRAINT "COUNTRIES_PK" PRIMARY KEY ("COUNTRY_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;

# JOB_HISTORY TABLE
  CREATE TABLE "MOSZCZYNSKIL"."JOB_HISTORY" 
   (	"EMPLOYEE_ID" NUMBER(*,0) NOT NULL ENABLE, 
	"START_DATE" DATE NOT NULL ENABLE, 
	"END_DATE" DATE, 
	"JOB_ID" NUMBER(*,0) NOT NULL ENABLE, 
	"DEPARTMENT_ID" NUMBER(*,0) NOT NULL ENABLE, 
	 CONSTRAINT "JOB_HISTORY_PK" PRIMARY KEY ("EMPLOYEE_ID", "START_DATE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;


# JOBS TABLE
  CREATE TABLE "MOSZCZYNSKIL"."JOBS" 
   (	"JOB_ID" NUMBER(*,0) NOT NULL ENABLE, 
	"JOB_TITLE" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"MIN_SALARY" FLOAT(126) NOT NULL ENABLE, 
	"MAX_SALARY" FLOAT(126) NOT NULL ENABLE, 
	 CONSTRAINT "JOBS_PK" PRIMARY KEY ("JOB_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;

# EMPLOYEES TABLE
  CREATE TABLE "MOSZCZYNSKIL"."EMPLOYEES" 
   (	"EMPLOYEE_ID" NUMBER(*,0) NOT NULL ENABLE, 
	"FIRST_NAME" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"LAST_NAME" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"EMAIL" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"PHONE_NUMBER" NUMBER(*,0) NOT NULL ENABLE, 
	"HIRE_DATE" DATE NOT NULL ENABLE, 
	"JOB_ID" NUMBER(*,0) NOT NULL ENABLE, 
	"SALARY" FLOAT(126) NOT NULL ENABLE, 
	"COMMISSION_PCT" FLOAT(126), 
	"MANAGER_ID" NUMBER(*,0), 
	"DEPARTMENT_ID" NUMBER(*,0) NOT NULL ENABLE, 
	 CONSTRAINT "EMPLOYEES_PK" PRIMARY KEY ("EMPLOYEE_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE, 
	 CONSTRAINT "EMPLOYEES_JOB_FK" FOREIGN KEY ("JOB_ID")
	  REFERENCES "MOSZCZYNSKIL"."JOBS" ("JOB_ID") ENABLE, 
	 CONSTRAINT "EMPLOYEES_DEPARTMENTS_FK" FOREIGN KEY ("DEPARTMENT_ID")
	  REFERENCES "MOSZCZYNSKIL"."DEPARTMENTS" ("DEPARTMENT_ID") ENABLE, 
	 CONSTRAINT "EMPLOYEES_MANAGER_FK" FOREIGN KEY ("MANAGER_ID")
	  REFERENCES "MOSZCZYNSKIL"."EMPLOYEES" ("EMPLOYEE_ID") ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

# LOCATIONS TABLE
  CREATE TABLE "MOSZCZYNSKIL"."LOCATIONS" 
   (	"LOCATION_ID" NUMBER(*,0) NOT NULL ENABLE, 
	"STREET_ADDRESS" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"POSTAL_CODE" VARCHAR2(6 BYTE) NOT NULL ENABLE, 
	"CITY" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"STATE_PROVINCE" VARCHAR2(100 BYTE) NOT NULL ENABLE, 
	"COUNTRY_ID" NUMBER(*,0) NOT NULL ENABLE, 
	 CONSTRAINT "LOCATIONS_PK" PRIMARY KEY ("LOCATION_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;


ALTER TABLE LOCATIONS
ADD CONSTRAINT COUNTRIES_FK FOREIGN KEY (COUNTRY_ID) REFERENCES COUNTRIES(COUNTRY_ID);

ALTER TABLE COUNTRIES
ADD CONSTRAINT REGIONS_FK FOREIGN KEY (REGION_ID) REFERENCES REGIONS(REGION_ID);



ALTER TABLE DEPARTMENTS
ADD CONSTRAINT LOCATIONS_FK FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS(LOCATION_ID);


ALTER TABLE EMPLOYEES
ADD CONSTRAINT EMPLOYEES_JOB_FK
  FOREIGN KEY (JOB_ID)      REFERENCES JOBS(JOB_ID);


ALTER TABLE EMPLOYEES
ADD CONSTRAINT EMPLOYEES_DEPARTMENTS_FK
  FOREIGN KEY (DEPARTMENT_ID)      REFERENCES DEPARTMENTS(DEPARTMENT_ID);


ALTER TABLE EMPLOYEES
ADD CONSTRAINT EMPLOYEES_MANAGER_FK
  FOREIGN KEY (MANAGER_ID)      REFERENCES EMPLOYEES(EMPLOYEE_ID);


ALTER TABLE DEPARTMENTS
ADD CONSTRAINT DEPARTMENTS_MANAGER_FK
  FOREIGN KEY (MANAGER_ID)      REFERENCES EMPLOYEES(EMPLOYEE_ID);


ALTER TABLE JOB_HISTORY
ADD CONSTRAINT JOBH_EMPLOYEES_FK
  FOREIGN KEY (EMPLOYEE_ID)      REFERENCES EMPLOYEES(EMPLOYEE_ID);


ALTER TABLE JOB_HISTORY
ADD CONSTRAINT JOBH_JOB_FK
  FOREIGN KEY (JOB_ID)      REFERENCES JOBS(JOB_ID);


ALTER TABLE JOB_HISTORY
ADD CONSTRAINT JOBH_DEPARTMENTS_FK
  FOREIGN KEY (DEPARTMENT_ID)      REFERENCES DEPARTMENTS(DEPARTMENT_ID);


ALTER TABLE JOBS
ADD CONSTRAINT JOBS_CK_SALARY_GAP CHECK (MAX_SALARY - MIN_SALARY >= 2000);


INSERT INTO REGIONS VALUES (1, 'Europ');
INSERT INTO COUNTRIES VALUES (100, 'Poland', 1);
INSERT INTO LOCATIONS(LOCATION_ID, STREET_ADDRESS, POSTAL_CODE, CITY, STATE_PROVINCE, COUNTRY_ID) VALUES (1000, 'ul. Prosta 1', '00-001', 'Warszawa', 'Mazowieckie', 100);
INSERT INTO DEPARTMENTS(DEPARTMENT_ID, DEPARTMENT_NAME, MANAGER_ID, LOCATION_ID) VALUES (10, 'IT', NULL, 1000);


INSERT INTO JOBS VALUES (1, 'CEO', 8000, 12000);
INSERT INTO JOBS VALUES (2, 'Developer', 5000, 7000);
INSERT INTO JOBS VALUES (3, 'Support', 3000, 5500);
INSERT INTO JOBS VALUES (4, 'Technician', 4000, 8000);

INSERT INTO EMPLOYEES(EMPLOYEE_ID, FIRST_NAME, LAST_NAME, EMAIL, PHONE_NUMBER, HIRE_DATE, JOB_ID, SALARY, COMMISSION_PCT, MANAGER_ID, DEPARTMENT_ID) VALUES (1, 'Ala', 'Nowak', 'ala.nowak@ex.com', '500100200', DATE '2009-01-10', 1, 10000, NULL, NULL, 10);
INSERT INTO EMPLOYEES(EMPLOYEE_ID, FIRST_NAME, LAST_NAME, EMAIL, PHONE_NUMBER, HIRE_DATE, JOB_ID, SALARY, COMMISSION_PCT, MANAGER_ID, DEPARTMENT_ID) VALUES (2, 'Karol', 'Kowalski', 'karol.kowalski@ex.com', '500100201', DATE '2025-03-17', 2, 5000, NULL, NULL, 10);
INSERT INTO EMPLOYEES(EMPLOYEE_ID, FIRST_NAME, LAST_NAME, EMAIL, PHONE_NUMBER, HIRE_DATE, JOB_ID, SALARY, COMMISSION_PCT, MANAGER_ID, DEPARTMENT_ID) VALUES (3, 'Maciek', 'Piekarski', 'maciek.piekarski@ex.com', '500100202', DATE '2022-11-28', 3, 3500, NULL, NULL, 10);
INSERT INTO EMPLOYEES(EMPLOYEE_ID, FIRST_NAME, LAST_NAME, EMAIL, PHONE_NUMBER, HIRE_DATE, JOB_ID, SALARY, COMMISSION_PCT, MANAGER_ID, DEPARTMENT_ID) VALUES (4, 'Ola', 'Zbigniewska', 'ola.zbigniewska@ex.com', '500100203', DATE '2020-07-02', 4, 6000, NULL, NULL, 10);


UPDATE DEPARTMENTS SET MANAGER_ID = 1 WHERE DEPARTMENT_ID = 10;

UPDATE EMPLOYEES SET MANAGER_ID = 1 WHERE EMPLOYEE_ID IN (2,3);


UPDATE JOBS
   SET MIN_SALARY = MIN_SALARY + 500,
       MAX_SALARY = MAX_SALARY + 500
 WHERE REGEXP_LIKE(JOB_TITLE, '[bs]', 'i');


DELETE FROM JOBS WHERE MAX_SALARY > 9000;


CREATE TABLE TEST (
  TEST_ID   NUMBER(5)    CONSTRAINT TEST_PK PRIMARY KEY,
  TEST_NAME VARCHAR2(100)
);

INSERT INTO TEST VALUES (1, 'Test');

DROP TABLE TEST;

FLASHBACK TABLE TEST TO BEFORE DROP;
